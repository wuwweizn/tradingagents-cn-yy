# 模型点数配置批量导出/导入功能

## 功能概述

模型点数配置支持批量导出和导入功能，方便管理员在不同环境之间迁移配置，或批量更新配置。

## 功能特性

### 导出功能
- ✅ 导出所有模型点数配置
- ✅ 导出研究深度点数配置
- ✅ 导出点数开关配置
- ✅ 支持两种导出格式：
  - **JSON格式**：便于程序处理和阅读
  - **Excel格式**：便于手动编辑和批量操作
- ✅ 包含导出时间戳和版本信息

### 导入功能
- ✅ 支持从JSON文件导入配置
- ✅ 支持从Excel文件导入配置
- ✅ 支持两种导入模式：
  - **合并模式**：保留现有配置，只更新导入的配置项
  - **覆盖模式**：完全替换现有配置
- ✅ 自动验证配置格式
- ✅ 显示详细的导入统计信息
- ✅ 错误处理和提示

## 使用方法

### 导出配置

#### JSON格式导出
1. 进入 **配置管理** → **模型点数设置** 页面
2. 在 **批量导出/导入配置** 区域，选择 **JSON格式**
3. 点击 **📥 导出配置为JSON** 按钮
4. 点击 **💾 下载JSON配置文件** 按钮下载文件
5. 文件命名格式：`model_points_config_YYYYMMDD_HHMMSS.json`

#### Excel格式导出
1. 进入 **配置管理** → **模型点数设置** 页面
2. 在 **批量导出/导入配置** 区域，选择 **Excel格式**
3. 点击 **📥 导出配置为Excel** 按钮
4. 点击 **💾 下载Excel配置文件** 按钮下载文件
5. 文件命名格式：`model_points_config_YYYYMMDD_HHMMSS.xlsx`
6. Excel文件包含多个工作表，便于分类编辑

### 导入配置

1. 进入 **配置管理** → **模型点数设置** 页面
2. 在 **批量导出/导入配置** 区域，选择导入模式：
   - **合并模式**：保留现有配置，只更新导入文件中包含的配置项
   - **覆盖模式**：完全替换现有配置为导入文件中的配置
3. 点击 **选择配置文件（支持JSON或Excel格式）**，选择要导入的文件
4. 查看文件预览（可选，JSON格式支持）
5. 点击 **📤 导入配置** 按钮执行导入
6. 查看导入统计信息

## 配置文件格式

### JSON格式

导出的JSON文件格式如下：

```json
{
  "version": "2.0",
  "export_time": "2025-01-15T10:30:00",
  "export_description": "TradingAgents-CN 模型点数配置导出",
  "default_points": 1,
  "model_points": [
    {
      "provider": "dashscope",
      "model": "qwen-turbo",
      "points": 1
    },
    {
      "provider": "google",
      "model": "gemini-2.5-pro",
      "points": 4
    }
  ],
  "research_depth_points": {
    "1": 1,
    "2": 2,
    "3": 3,
    "4": 5,
    "5": 8
  },
  "points_toggle": {
    "enable_research_depth_points": true,
    "enable_model_points": true
  }
}
```

### Excel格式

导出的Excel文件包含以下工作表：

#### 1. 模型点数配置工作表
包含以下列：
- **提供商 (Provider)**: LLM提供商名称
- **模型名称 (Model)**: 模型名称
- **消耗点数 (Points)**: 消耗的点数

#### 2. 研究深度配置工作表
包含以下列：
- **研究深度级别 (Depth)**: 研究深度级别（1-5）
- **消耗点数 (Points)**: 消耗的点数
- **说明**: 级别说明

#### 3. 开关配置工作表
包含以下列：
- **配置项**: 配置项名称
- **当前值**: 当前配置值（True/False）
- **说明**: 配置说明

#### 4. 配置信息工作表
包含以下列：
- **配置项**: 配置项名称
- **值**: 配置值

### 字段说明

- `version`: 配置格式版本（当前为 "2.0"）
- `export_time`: 导出时间（ISO格式）
- `export_description`: 导出描述
- `default_points`: 默认点数（未配置模型使用的点数）
- `model_points`: 模型点数配置列表
  - `provider`: LLM提供商（如：dashscope, google, openai等）
  - `model`: 模型名称
  - `points`: 消耗的点数
- `research_depth_points`: 研究深度点数配置
  - 键为研究深度级别（1-5）
  - 值为消耗的点数
- `points_toggle`: 点数开关配置
  - `enable_research_depth_points`: 是否启用研究深度点数消耗
  - `enable_model_points`: 是否启用模型点数消耗

## 导入模式说明

### 合并模式
- 保留所有现有配置
- 只更新导入文件中包含的配置项
- 如果导入文件中的配置项不存在，则添加新配置
- 如果导入文件中的配置项已存在，则更新该配置
- **适用场景**：部分更新配置、添加新模型配置

### 覆盖模式
- 完全替换现有配置
- 只保留导入文件中的配置项
- 导入文件中不包含的配置项将被删除
- **适用场景**：完全重置配置、从备份恢复配置

## 导入统计信息

导入完成后会显示以下统计信息：

- **新增模型配置**: 导入文件中新增的模型配置数量
- **更新模型配置**: 导入文件中更新现有模型配置的数量
- **更新研究深度配置**: 更新的研究深度配置数量
- **更新开关配置**: 是否更新了点数开关配置

如果导入过程中有错误或警告，会在统计信息下方显示。

## 注意事项

1. **备份重要配置**：在导入配置前，建议先导出当前配置作为备份
2. **覆盖模式谨慎使用**：覆盖模式会删除所有未在导入文件中的配置
3. **文件编码**：
   - JSON文件：确保使用UTF-8编码
   - Excel文件：系统自动处理编码
4. **格式验证**：系统会自动验证导入文件的格式，格式错误会显示详细错误信息
5. **版本兼容性**：支持版本 1.0 和 2.0 的配置文件
6. **Excel格式要求**：
   - 需要安装openpyxl库：`pip install openpyxl`
   - Excel文件必须包含正确的工作表名称
   - 列名支持中英文，系统会自动识别
7. **Excel编辑建议**：
   - 可以直接在Excel中编辑配置，然后重新导入
   - 注意保持数据格式正确（点数为整数）
   - 布尔值可以使用True/False、是/否、1/0等格式

## 常见问题

### Q: 导入后配置没有生效？
A: 导入成功后会自动重新加载配置。如果配置没有生效，请刷新页面或重新加载配置。

### Q: 可以只导入部分配置吗？
A: 可以。使用合并模式，导入文件中只包含要更新的配置项即可。

### Q: 导入失败怎么办？
A: 检查导入文件的格式是否正确，确保：
- 文件是有效的JSON格式
- 包含必要的字段（version, model_points等）
- 字段值类型正确（points为整数，toggle为布尔值等）

### Q: 如何批量添加多个新模型配置？
A: 使用合并模式，在导入文件中添加所有新模型的配置项，导入时会自动添加。

### Q: Excel格式和JSON格式有什么区别？
A: 
- **JSON格式**：更适合程序处理和自动化场景
- **Excel格式**：更适合手动编辑和批量操作，可以在Excel中直接编辑配置

### Q: 使用Excel格式需要安装什么？
A: 需要安装openpyxl库：`pip install openpyxl`

### Q: Excel文件的工作表名称可以修改吗？
A: 可以，但建议保持默认名称（模型点数配置、研究深度配置、开关配置），系统会自动识别中英文列名。

## 技术实现

### 导出函数
- `export_all_config()`: 导出所有配置为字典
- `export_config_to_json()`: 导出配置为JSON字符串或文件

### 导入函数
- `import_config_from_dict()`: 从字典导入配置
- `import_config_from_json()`: 从JSON字符串导入配置
- `import_config_from_file()`: 从文件导入配置

### 配置验证
- 自动验证配置格式
- 检查版本兼容性
- 验证字段类型和取值范围
- 提供详细的错误信息

## 更新日志

- **v2.1** (2025-01-15): 添加Excel格式支持
  - 支持导出为Excel格式（.xlsx）
  - 支持从Excel文件导入配置
  - Excel文件包含多个工作表，便于分类编辑
  - 自动识别中英文列名

- **v2.0** (2025-01-15): 添加批量导出/导入功能
  - 支持导出所有配置类型
  - 支持合并和覆盖两种导入模式
  - 添加详细的导入统计和错误提示

